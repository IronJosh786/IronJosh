this is chapter 6 in testing branch