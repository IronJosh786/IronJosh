this is chapter 7 in testing branch